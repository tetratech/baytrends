<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Create Seasonally Detrended Salinty Data Set — detrended.salinity • baytrends</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Create Seasonally Detrended Salinty Data Set — detrended.salinity"><meta property="og:description" content="This function creates a seasonally detrended salinity data set for selected
  stations. The created data set is used to support application of GAMs
  that include a hydrologic term as one of the independent variables. The output
  from this function should be stored as an .rda file for repeated use with 
  baytrends."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">baytrends</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.6.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Detrending_Flow_and_Salinity_Data.html">Flow and Salinity Data Sets</a>
    </li>
    <li>
      <a href="../articles/Processing_Censored_Data.html">Processing Censored Water Quality Data</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/tetratech/baytrends/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create Seasonally Detrended Salinty Data Set</h1>
    <small class="dont-index">Source: <a href="https://github.com/tetratech/baytrends/blob/HEAD/R/detrended.salinity.R" class="external-link"><code>R/detrended.salinity.R</code></a></small>
    <div class="hidden name"><code>detrended.salinity.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function creates a seasonally detrended salinity data set for selected
  stations. The created data set is used to support application of GAMs
  that include a hydrologic term as one of the independent variables. The output
  from this function should be stored as an .rda file for repeated use with 
  baytrends.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">detrended.salinity</span><span class="op">(</span>
  <span class="va">df.sal</span>,
  dvAvgWinSel <span class="op">=</span> <span class="fl">30</span>,
  lowess.f <span class="op">=</span> <span class="fl">0.2</span>,
  minObs <span class="op">=</span> <span class="fl">40</span>,
  minObs.sd <span class="op">=</span> <span class="fl">10</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>df.sal</dt>
<dd><p>data frame with salinty data (required variables in data frame
are: station, date, layer, and salinity)</p></dd>
<dt>dvAvgWinSel</dt>
<dd><p>Averaging window (days) selection for pooling data to 
compute summary statistics</p></dd>
<dt>lowess.f</dt>
<dd><p>lowess smoother span applied to computed standard deviation
(see Details). This gives the proportion of points which influence the
smooth at each value. Larger values give more smoothness.</p></dd>
<dt>minObs</dt>
<dd><p>Minimum number of observations for performing analysis (default
is 40)</p></dd>
<dt>minObs.sd</dt>
<dd><p>Minimum number of observations in averaging window for
calculation of the standard deviation (default is 10)</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Returns a list of seasonally detrended salinity data. You should save
  the resulting list as salinity.detrended for use with baytrends.  This
  function also creates diagnostic plots that can be saved to a report when
  this function is called from an .Rmd script.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function returns a list of seasonally detrended salinity and companion 
  statistics; and relies on a user supplied data frame that contains the
  following variables: station, date, layer, and salinity. See
  structure of sal data in example below.</p>  
<p>It is the user responsibility to save the resulting list as
  <b>salinity.detrended</b> for integration with baytrends.</p>  
<p>For the purposes of baytrends, it is expected that the user would identify
  a data set with all salinity data that are expected to be evaluated so that
  a single data file is created. The following computation steps are performed:</p>  
<p>1) Extract the list of stations, minimum year, and maximum year in data set.
  Initialize the <b>salinity.detrended</b> list with this information along with
  meta data documenting the retrieval parameters.</p>  
<p>2) Downselect the input data frame to only include data where the 
  layer is equal to 'S', 'AP', 'BP' or 'B'.</p>  
<p>3) Average the 'S' and 'AP' salinity data; and the 'B' and 'BP salinity
  data together to create average salinity values for SAP (surface and above pycnocline)
  and BBP (bottom and below pycnocline), respectively. These values are stored
  as the variables, <b>salinity.SAP</b> and <b>salinity.BBP</b> together with the 
  <b>date</b> and day of year (<b>doy</b>) in a data frame corresponding to the
  station ID.</p>  
<p>4) For each station/layer combination with atleast <b>minObs</b> observations,
  a seasonal GAM, i.e., gamoutput &lt;- gam(salinity ~  s(doy, bs='cc')) is
  evaluated and the predicted values stored in the above data frame 
  as <b>salinity.SAP.gam</b> and <b>salinity.BBP.gam</b>.</p>  
<p>5) The GAM residuals, i.e., "residuals(gamoutput)" are extracted and stored
  as the variable, <b>SAP</b> or <b>BBP</b> in the above data frame. (These are the 
  values that are used for GAMs that include salinity.)</p>  
<p>6) After the above data frame is created and appended to the 
  list <b>salinity.detrended</b>, the following four (4) additional
  data frames are created for each station.</p>  
<p><b>mean</b> -- For each doy (i.e., 366 days of year), the mean across all 
  years for each value of d. Since samples are not collected on a daily basis
  it is necessary to aggregate data from within a +/- one-half of
  <b>dvAvgWinSel</b>-day window around d. (This includes wrapping around the
  calendar year. That is, the values near the beginning of the year, say
  January 2, would include values from the last part of December and the
  first part of January. The variables in the mean data frame are doy, SAP, and BBP.</p>  
<p><b>sd</b> -- For each doy (i.e., 366 days of year), the standard deviation 
  across all years for each value of d. (See mean calculations for additional details.)</p>  
<p><b>nobs</b> -- For each doy (i.e., 366 days of year), the number of observations 
  across all years for each value of d. (See mean calculations for additional details.)</p>  
<p><b>lowess.sd</b> -- Lowess smoothed standard deviations. It is noted that
  some stations do not include regular sampling in all months of the year or
  for other reasons have few observations from which to compute standard
  deviations. Through visual inspection of plots, we found that the standard
  deviation could become unstable when the number  of observations is small.
  For this reason, when the number of observations is less than
  <b>minObs.sd</b>, the corresponding value of lowess.sd is removed and
  interpolated from the remaining observations.</p>   
<p>The above four data frames (mean, sd, nobs, and lowess.sd) are created, they
  are added to a list using a <b>station.sum</b> naming convention and appended to the 
  list <b>salinity.detrended</b>.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co"># Show Example Dataset (sal)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sal</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Define Function Inputs</span></span>
<span class="r-in"><span class="va">df.sal</span>        <span class="op">&lt;-</span> <span class="va">sal</span></span>
<span class="r-in"><span class="va">dvAvgWinSel</span>   <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span class="r-in"><span class="va">lowess.f</span>      <span class="op">&lt;-</span> <span class="fl">0.2</span></span>
<span class="r-in"><span class="va">minObs</span>        <span class="op">&lt;-</span> <span class="fl">40</span></span>
<span class="r-in"><span class="va">minObs.sd</span>    <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span class="r-in">                 </span>
<span class="r-in"><span class="co"># Run Function</span></span>
<span class="r-in"><span class="va">salinity.detrended</span> <span class="op">&lt;-</span> <span class="fu">detrended.salinity</span><span class="op">(</span><span class="va">df.sal</span>, <span class="va">dvAvgWinSel</span>, </span>
<span class="r-in">                                 <span class="va">lowess.f</span>, <span class="va">minObs</span>, <span class="va">minObs.sd</span><span class="op">)</span> </span>
<span class="r-in"><span class="op">}</span>              </span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Erik W Leppo.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

