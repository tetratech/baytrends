<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Perform GAM analysis — gamTest • baytrends</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Perform GAM analysis — gamTest"><meta property="og:description" content="Perform GAM analysis. Relies on mgcv::gam to perform general additive model.
gam
The baseDay function has been added to this package from the smwrBase package."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">baytrends</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Detrending_Flow_and_Salinity_Data.html">Flow and Salinity Data Sets</a>
    </li>
    <li>
      <a href="../articles/Processing_Censored_Data.html">Processing Censored Water Quality Data</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/tetratech/baytrends/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Perform GAM analysis</h1>
    <small class="dont-index">Source: <a href="https://github.com/tetratech/baytrends/blob/HEAD/R/gamTest.r" class="external-link"><code>R/gamTest.r</code></a></small>
    <div class="hidden name"><code>gamTest.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Perform GAM analysis. Relies on mgcv::gam to perform general additive model.
<code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code>
The baseDay function has been added to this package from the smwrBase package.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">gamTest</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  <span class="va">dep</span>,</span>
<span>  <span class="va">stat</span>,</span>
<span>  layer <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  <span class="va">analySpec</span>,</span>
<span>  gamTable <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  gamPlot <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  gamDiffModel <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  flow.detrended <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  salinity.detrended <span class="op">=</span> <span class="cn">NA</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>df</dt>
<dd><p>data frame</p></dd>


<dt>dep</dt>
<dd><p>dependent variable</p></dd>


<dt>stat</dt>
<dd><p>station</p></dd>


<dt>layer</dt>
<dd><p>layer</p></dd>


<dt>analySpec</dt>
<dd><p>analytical specifications</p></dd>


<dt>gamTable</dt>
<dd><p>gam table setting (set to FALSE to turn off table output)</p></dd>


<dt>gamPlot</dt>
<dd><p>gam plot setting (set to FALSE to turn off plotting)</p></dd>


<dt>gamDiffModel</dt>
<dd><p>GAM model(s) used for computing differences on sub-annual/multi-period basis</p></dd>


<dt>flow.detrended</dt>
<dd><p>data generated by detrended.flow.  Default = NA.</p></dd>


<dt>salinity.detrended</dt>
<dd><p>data generated by detrended.flow.  Default = NA.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Returns a list with results</p><ul><li><p><strong>stat.gam.result --</strong> Data frame with summary results in a tabular format suitable for output to a csv file</p></li>
<li><p><strong>chng.gam.result --</strong> Data frame with estimate of change for sub-annual differences based on the 
settings specified in <code>gamDiffModel</code>. Includes all data from stat.gam.result and sub-annual estimates of change
in a tabular format suitable for output to a csv file.</p></li>
<li><p><strong>data --</strong> Data frame of data used in analysis (for example years with large proportion of censored data might be removed from the analysis and not included in this data frame)</p></li>
<li><p><strong>data.all --</strong> Data frame of all potential data available for analysis</p></li>
<li><p><strong>iSpec --</strong> List of baytrends analysis settings used for a specific analysis of station and parameter</p></li>
<li><p><strong>gamOutput0 --</strong>	Results including model predictions for gam formula 0 (i.e., gam0)</p></li>
<li><p><strong>gamOutput1 --</strong>	Results including model predictions for gam formula 1 (i.e., gam1)</p></li>
<li><p><strong>gamOutput2 --</strong>	Results including model predictions for gam formula 2 (i.e., gam2)</p></li>
<li><p><strong>gamOutput3 --</strong>	Results including model predictions for gam formula 3 (i.e., gam3)</p></li>
<li><p><strong>gamOutput4 --</strong>	Results including model predictions for gam formula 4 (i.e., gam4)</p></li>
<li><p><strong>gamOutput5 --</strong>	Results including model predictions for gam formula 5 (i.e., gam5)</p></li>
<li><p><strong>gamOutput6 --</strong>	Results including model predictions for gam formula 6 (i.e., gam6)</p></li>
</ul><p><strong>gamOutput* --</strong> For each evaluated model, <code>gamOutput*</code> (see above
element list) is a list with the following elements:</p>


<ul><li><p><strong>gamOption --</strong> gam formula ID, i.e., 0, 1, 2, 3, 4 , 5, 6 corresponding to gam0, gam1, gam2, etc.</p></li>
<li><p><strong>gamRslt --</strong> mgcv::gam output</p></li>
<li><p><strong>gamRsltSum --</strong> "summary" of mgcv::gam, i.e., summary(mgcv::gam)</p></li>
<li><p><strong>gamANOVAtbl --</strong> GAM Analysis of Variance table</p></li>
<li><p><strong>gamCoefftbl --</strong> GAM Parameter Coefficients table</p></li>
<li><p><strong>gamDiagnostics --</strong> GAM Diagnostics table(AIC, RMSE, and Adj. R-squared)</p></li>
<li><p><strong>perChange --</strong> Estimates of Change table</p></li>
<li><p><strong>porDiff.regular --</strong> Estimate of change in list format</p></li>
<li><p><strong>porDiff.adjusted --</strong> Estimate of change adjusted for interventions in list format</p></li>
<li><p><strong>predictions --</strong> Data frame of gam predictions (all information used to create baytrends graphics excluding measurements)</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>Set <code>gamPlot=FALSE</code> to turn off plotting. Computing the information
("predictions") to create plots is one of the more time consumings aspects of
the <code>gamTest</code> function. Setting <code>gamPlot=FALSE</code> turns off these
computations and speeds up <code>gamTest</code>. The disadvantage is that no
predictions are returned; however, the tabularized results stored in
<code>stat.gam.result</code> and, if requested, <code>chng.gam.result</code> are still
returned.</p>
<p>Setting <code>gamPlot</code> to a value between 1-30 changes the resolution of the
resulting figure by setting the interval on which the prediction data set is
made. By default <code>gamPlot</code> is set to 10. That is, a prediction is made
every 10th day, or about 36 predictions per year. Values closer to 1 result
in larger returned prediction data sets and take more computation time.
Values closer to 30 result in smaller returned data sets and take less
computation time. Although there is no change in the fitted model, values
closer to 30 may have slight degraded figure quality if there is subtantial
seasonality in the fitted model since the seasonal minimum and maximum might
not be included in the prediction data set and therefore not plotted. Values
greater than 30 are treated as 30. Setting <code>gamPlot=30</code> might be
advantangeous when the analysis only requires cursory figure examination.</p>
<p>Setting <code>gamTable=FALSE</code> will turn off table output to the console. This
may be advantageous to reduce the amount of output. Since these computations
do not significantly affect <code>gamTest</code> run time, the standard Analysis of
Variance, GAM Parameter Coefficients, Diagnostics, and Estimates of Change
tables are returned from <code>gamTest</code> regardless of the <code>gamTable</code>
setting. Many of the values from these tables are also returned as part of 
tabularized <code>stat.gam.result</code>.</p>
<p>The default settings for <code>gamDiffModel</code> (i.e., <code>gamDiffModel=NA</code>)
will not result in sub-annual (i.e., seasonal) differences being computed. In
this default setting, the returned <code>chng.gam.result</code> that is returned
from <code>gamTest</code> will be empty. If <code>gamDiffModel</code> is a value (i.e.,
not <code>NA</code>), then <code>chng.gam.result</code> will include one row for each
combination of years specified in <code>analySpec$gamDiffPeriods</code>, seasons
specified in <code>analySpec$gamDiffSeason</code>, and the number of models listed
in <code>gamDiffModel</code>. For example <code>gamDiffModel=c(0,1,2)</code> would
result in sub-annual being computed for gam0, gam1, and gam2.</p>
<p><strong>Flow and Salinity Adjustments (gam4).</strong> It is necessary to create and
pass properly formatted data via the <code>flow.detrended</code> and
<code>salinity.detrended</code> arguments to evaluate gam4 models. See
<code><a href="detrended.flow.html">detrended.flow</a></code> and <code><a href="detrended.salinity.html">detrended.salinity</a></code> for more
information on how to create properly formatted data.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Specify parameter and station to analyze</span></span></span>
<span class="r-in"><span><span class="va">dep</span>        <span class="op">&lt;-</span> <span class="st">'do'</span></span></span>
<span class="r-in"><span><span class="va">stat</span>       <span class="op">&lt;-</span> <span class="st">'CB5.4'</span></span></span>
<span class="r-in"><span><span class="va">layer</span>      <span class="op">&lt;-</span> <span class="st">'B'</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Prepare data and set up specifications for analysis</span></span></span>
<span class="r-in"><span><span class="va">dfr</span> <span class="op">&lt;-</span> <span class="fu"><a href="analysisOrganizeData.html">analysisOrganizeData</a></span> <span class="op">(</span><span class="va">dataCensored</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df</span>        <span class="op">&lt;-</span> <span class="va">dfr</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">analySpec</span> <span class="op">&lt;-</span> <span class="va">dfr</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Apply gamTest </span></span></span>
<span class="r-in"><span><span class="va">gamResult</span> <span class="op">&lt;-</span> <span class="fu">gamTest</span><span class="op">(</span><span class="va">df</span>, <span class="va">dep</span>, <span class="va">stat</span>, <span class="va">layer</span>, analySpec<span class="op">=</span><span class="va">analySpec</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="gamPlotDisp.html">gamPlotDisp</a></span><span class="op">(</span>gamResult <span class="op">=</span> <span class="va">gamResult</span>, analySpec <span class="op">=</span> <span class="va">analySpec</span>,</span></span>
<span class="r-in"><span>            fullModel <span class="op">=</span> <span class="fl">2</span>, seasAvgModel <span class="op">=</span> <span class="fl">2</span>, seasonalModel <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>            diffType <span class="op">=</span> <span class="st">"regular"</span>, obserPlot <span class="op">=</span> <span class="cn">TRUE</span>, interventionPlot <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>            seasAvgPlot <span class="op">=</span> <span class="cn">TRUE</span>, seasAvgConfIntPlot <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>            seasAvgSigPlot <span class="op">=</span> <span class="cn">FALSE</span>, fullModelPlot <span class="op">=</span> <span class="cn">TRUE</span>, seasModelPlot <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>            BaseCurrentMeanPlot <span class="op">=</span> <span class="cn">FALSE</span>, adjustedPlot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Apply gamTestSeason</span></span></span>
<span class="r-in"><span><span class="va">gamResult2</span> <span class="op">&lt;-</span> <span class="fu"><a href="gamTestSeason.html">gamTestSeason</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">dep</span>, <span class="va">stat</span>, <span class="va">layer</span>, analySpec<span class="op">=</span><span class="va">analySpec</span>,</span></span>
<span class="r-in"><span>                            gamSeasonPlot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"7/15-8/15"</span>, <span class="st">"purple"</span>, <span class="st">"range"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="gamPlotDispSeason.html">gamPlotDispSeason</a></span><span class="op">(</span>gamResult <span class="op">=</span> <span class="va">gamResult2</span>, analySpec <span class="op">=</span> <span class="va">analySpec</span>,</span></span>
<span class="r-in"><span>                  fullModel <span class="op">=</span> <span class="fl">2</span>, seasAvgModel <span class="op">=</span> <span class="fl">2</span>, seasonalModel <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                  diffType <span class="op">=</span> <span class="st">"regular"</span>, obserPlot <span class="op">=</span> <span class="cn">TRUE</span>, interventionPlot <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                  seasAvgPlot <span class="op">=</span> <span class="cn">TRUE</span>, seasAvgConfIntPlot <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                  seasAvgSigPlot <span class="op">=</span> <span class="cn">FALSE</span>, fullModelPlot <span class="op">=</span> <span class="cn">FALSE</span>, seasModelPlot <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                  BaseCurrentMeanPlot <span class="op">=</span> <span class="cn">TRUE</span>, adjustedPlot <span class="op">=</span> <span class="cn">FALSE</span>, gamSeasonFocus <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Erik W Leppo.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

