<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Create Seasonally Detrended Flow Data Set — detrended.flow • baytrends</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Create Seasonally Detrended Flow Data Set — detrended.flow"><meta property="og:description" content="This function creates a seasonally detrended flow data set for
  selected USGS gages. The created data set is used to support application of
  GAMs that include a hydrologic term as one of the independent variables.
  The output from this function should be stored as an .rda file for repeated
  use with baytrends."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">baytrends</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Detrending_Flow_and_Salinity_Data.html">Flow and Salinity Data Sets</a>
    </li>
    <li>
      <a href="../articles/Processing_Censored_Data.html">Processing Censored Water Quality Data</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/tetratech/baytrends/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create Seasonally Detrended Flow Data Set</h1>
    <small class="dont-index">Source: <a href="https://github.com/tetratech/baytrends/blob/HEAD/R/detrended.flow.R" class="external-link"><code>R/detrended.flow.R</code></a></small>
    <div class="hidden name"><code>detrended.flow.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function creates a seasonally detrended flow data set for
  selected USGS gages. The created data set is used to support application of
  GAMs that include a hydrologic term as one of the independent variables.
  The output from this function should be stored as an .rda file for repeated
  use with baytrends.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">detrended.flow</span><span class="op">(</span></span>
<span>  <span class="va">usgsGageID</span>,</span>
<span>  <span class="va">siteName</span>,</span>
<span>  <span class="va">yearStart</span>,</span>
<span>  <span class="va">yearEnd</span>,</span>
<span>  dvAvgWinSel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">60</span>, <span class="fl">90</span>, <span class="fl">120</span>, <span class="fl">150</span>, <span class="fl">180</span>, <span class="fl">210</span><span class="op">)</span>,</span>
<span>  dvAvgWgtSel <span class="op">=</span> <span class="st">"uniform"</span>,</span>
<span>  dvAvgSidesSel <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  lowess.f <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  span <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  max.fill <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>usgsGageID</dt>
<dd><p>USGS GageIDs (e.g., "01491000")</p></dd>


<dt>siteName</dt>
<dd><p>USGS SiteName (only used for plots)</p></dd>


<dt>yearStart</dt>
<dd><p>start year (recommended as at least one year before
corresponding water quality data set)</p></dd>


<dt>yearEnd</dt>
<dd><p>end year</p></dd>


<dt>dvAvgWinSel</dt>
<dd><p>Averaging window (days) for smoothing the residuals of the
seasonally adjusted daily flow values 
[default = c(1, 5, 10, 15, 20, 30, 40, 50, 60, 90, 120, 150, 180, 210)]</p></dd>


<dt>dvAvgWgtSel</dt>
<dd><p>Averaging method ("uniform", "weighted", or "centered")
for creating weights. If using "weighted" then use dvAvgSidesSel=1.  If
using "centered" then use dvAvgSidesSel=2. [default = "uniform"]</p></dd>


<dt>dvAvgSidesSel</dt>
<dd><p>If dvAvgSidesSel=1 only past values are used, if
dvAvgSidesSel=2 then values are centered around lag 0. [default = 1]</p></dd>


<dt>lowess.f</dt>
<dd><p>lowess smoother span applied to computed standard deviation
(see Details). This gives the proportion of points which influence the
smooth at each value. Larger values give more smoothness. [default = 0.2]</p></dd>


<dt>span</dt>
<dd><p>maximum number of observations on each side of range of missing
values to use in filling in data [default = 10]</p></dd>


<dt>max.fill</dt>
<dd><p>maximum gap to fill in [default = 10]</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Returns a list of seasonally detrended flow data. You should save the
  resulting list as flow.detrended for use with baytrends.  This function
  also creates diagnostic plots that can be saved to a report when this
  function is called from an .Rmd script.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function returns a list of seasonally detrended flow and 
  companion statistics; and relies on USGS' dataRetrieval package to retrieve
  daily flow data.</p>  
<p>It is the user responsibility to save the resulting list as 
  <b>flow.detrended</b> for integration with baytrends.</p>  
<p>For the purposes of baytrends, it is expected that the user 
  would identify all USGS gages that are expected to be evaluated so that a 
  single data file is created. To best match up with water quality data, we 
  recommend retrieving flow data for one year prior to the first year of 
  water quality data. This allows for creating a time-averaged flow data set 
  and not loose the first few months of water quality data due to lack of 
  matching flow data. Data retrievals should also be made in light of the 
  time needed by the USGS to review and approve their flow records.</p>  
<p>After retrieval, the following computation steps are performed to create a
  data frame for each USGS gage (the data frame naming convention is
  <b>qNNNNNNNN</b> where NNNNNNNN is the USGS gage ID):</p>  
<p>1) The daily flow data are converted to cubic meters per second [cms] and
  stored as the variable <b>q</b>.</p>  
<p>2) The day of year (<b>doy</b>) is added to the data set. We use a 366 day
  calendar regardless of leap year.</p>  
<p>3) The Log (ln) flow is computed and stored as <b>LogQ</b>.</p>  
<p>4) A seasonal GAM, i.e., gamoutput &lt;- gam(LogQ ~  s(doy, bs='cc')) is
  evaluated and the predicted values stored as <b>qNNNNNNNN.gam</b>.</p>  
<p>5) The GAM residuals, i.e., "residuals(gamoutput)" are extracted and stored
  as the variable, <b>d1</b>.</p>  
<p>6) Based on the specifications for dvAvgWinSel, dvAvgWgtSel, and
  dvAvgSidesSel, the values of <b>d1</b> are time averaged and additional
  variables <b>dxxx</b> are added to the data frame where xxx corresponds to
  list of averaging windows specified in dvAvgWinSel. These values of
  <b>dxxx</b> are used in GAMs that include a hydrologic independent
  variable.</p>  
<p>After the above data frame is created, the following four (4) additional
  data frames are created for each USGS gage and combined into a list named
  <b>qNNNNNNNN.sum</b>:</p>  
<p><b>mean</b> -- For each doy (i.e., 366 days of year), the mean across all
  years for each value of d in the above data frame, qNNNNNNNN.</p>  
<p><b>sd</b> -- For each doy (i.e., 366 days of year), the standard deviation 
  across all years for each value of d in the above data frame, qNNNNNNNN.</p>  
<p><b>nobs</b> -- For each doy (i.e., 366 days of year), the number of 
  observations across all years for each value of d in the above data frame
  , qNNNNNNNN.</p>  
<p><b>lowess.sd</b> -- Lowess smoothed standard deviations. (These values are
  used for computing confidence intervals in the flow averaged GAM.)</p>  
<p>The process of creating the above data frame, <b>qNNNNNNNN</b>, and list,
  <b>qNNNNNNNN.sum</b>, is repeated for each USGS gage and combined together
  in a single list. The beginning of the list includes meta data documenting
  the retrieval parameters.</p>  
<p>This function can be used in conjunction with an RMD file to knit (create)
  a report (DOCX or HTML).</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Define Function Inputs</span></span></span>
<span class="r-in"><span><span class="va">usgsGageID</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"01491000"</span>, <span class="st">"01578310"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">siteName</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Choptank River near Greensboro, MD"</span>,</span></span>
<span class="r-in"><span>                   <span class="st">"Susquehanna River at Conowingo, MD"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">yearStart</span>     <span class="op">&lt;-</span> <span class="fl">1983</span></span></span>
<span class="r-in"><span><span class="va">yearEnd</span>       <span class="op">&lt;-</span> <span class="fl">2016</span></span></span>
<span class="r-in"><span><span class="va">dvAvgWinSel</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span>, <span class="fl">60</span>, <span class="fl">90</span>, <span class="fl">120</span>, <span class="fl">150</span>, <span class="fl">180</span>, <span class="fl">210</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dvAvgWgtSel</span>   <span class="op">&lt;-</span> <span class="st">"uniform"</span></span></span>
<span class="r-in"><span><span class="va">dvAvgSidesSel</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="va">lowess.f</span>      <span class="op">&lt;-</span> <span class="fl">0.2</span></span></span>
<span class="r-in"><span>                 </span></span>
<span class="r-in"><span><span class="co"># Run Function</span></span></span>
<span class="r-in"><span><span class="va">flow.detrended</span> <span class="op">&lt;-</span> <span class="fu">detrended.flow</span><span class="op">(</span><span class="va">usgsGageID</span>, <span class="va">siteName</span>, <span class="va">yearStart</span>, <span class="va">yearEnd</span></span></span>
<span class="r-in"><span>                                , <span class="va">dvAvgWinSel</span>, <span class="va">dvAvgWgtSel</span>, <span class="va">dvAvgSidesSel</span></span></span>
<span class="r-in"><span>                               , <span class="va">lowess.f</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Erik W Leppo.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

